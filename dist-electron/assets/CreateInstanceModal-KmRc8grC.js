import{r as a,j as e,p as T}from"./index-DrT-USLH.js";import{i as m}from"./integratedDownloadService-BHtEfeEq.js";import{instanceProfileService as q}from"./instanceProfileService-DFHT9o1C.js";import{A as G,m as P}from"./proxy-J72GlzLQ.js";const fe=({isOpen:g,onClose:p,onCreated:F})=>{const[y,Q]=a.useState(""),[n,D]=a.useState("vanilla"),[s,O]=a.useState(""),[v,j]=a.useState(""),[w,R]=a.useState(!1),[U,B]=a.useState(2048),[N,E]=a.useState(4096),[z,M]=a.useState(8192),[X,K]=a.useState([]),[k,Y]=a.useState({}),[V,Z]=a.useState({}),[C,_]=a.useState({}),[S,ee]=a.useState({}),[l,x]=a.useState(!1),[A,c]=a.useState(null),[L,re]=a.useState(""),[se,ae]=a.useState(""),[W,f]=a.useState("17"),[d,te]=a.useState(null),[b,oe]=a.useState(null);a.useEffect(()=>{(async()=>{var t,i;try{if((i=(t=window.api)==null?void 0:t.system)!=null&&i.getTotalMemory){const o=await window.api.system.getTotalMemory(),u=Math.floor(o/(1024*1024));M(u),B(Math.min(2048,Math.floor(u/4))),E(Math.min(8192,Math.floor(u/2)))}else{const o=Math.min(16384,Math.max(4096,navigator.deviceMemory?navigator.deviceMemory*1024:8192));M(o)}}catch(o){console.warn("No se pudo obtener la memoria total del sistema:",o);const u=navigator.deviceMemory?navigator.deviceMemory*1024:8192;M(u)}})()},[]),a.useEffect(()=>{g&&ne()},[g]);const ne=async()=>{if(g){x(!0),c(null);try{const t=(await m.getMinecraftVersions()).filter(i=>i.type==="release");K(t)}catch(r){console.error("Error al cargar versiones:",r),c("Error al cargar las versiones disponibles. Por favor, inténtalo de nuevo más tarde.")}finally{x(!1)}}};a.useEffect(()=>{if(s){const r=parseInt(s.split(".")[1]||"0",10);r>=21?f("21"):r>=17?f("17"):r>=16?f("16"):f("8")}},[s]),a.useEffect(()=>{s&&n!=="vanilla"&&ie()},[n,s]);const ie=async()=>{if(s){console.log(`[CreateInstanceModal] Cargando versiones de ${n} para MC ${s}`),x(!0),c(null);try{switch(n){case"fabric":if(!V[s]){console.log("[CreateInstanceModal] Obteniendo versiones de Fabric...");const r=await m.getFabricVersions(s);console.log("[CreateInstanceModal] Versiones de Fabric obtenidas:",r),Z(t=>({...t,[s]:r}))}break;case"forge":if(!k[s]){console.log("[CreateInstanceModal] Obteniendo versiones de Forge...");const r=await m.getForgeVersions(s);console.log("[CreateInstanceModal] Versiones de Forge obtenidas:",r),Y(t=>({...t,[s]:r})),r.length>0&&!v&&j(r[0].version)}break;case"quilt":if(!C[s]){console.log("[CreateInstanceModal] Obteniendo versiones de Quilt...");const r=await m.getQuiltVersions(s);console.log("[CreateInstanceModal] Versiones de Quilt obtenidas:",r),_(t=>({...t,[s]:r}))}break;case"neoforge":if(!S[s]){console.log("[CreateInstanceModal] Obteniendo versiones de NeoForge...");const r=await m.getNeoForgeVersions(s);console.log("[CreateInstanceModal] Versiones de NeoForge obtenidas:",r),ee(t=>({...t,[s]:r}))}break}}catch(r){console.error(`[CreateInstanceModal] Error al cargar versiones de ${n}:`,r),c(`Error al cargar las versiones de ${n}: ${r.message||"Error desconocido"}`)}finally{x(!1)}}};a.useEffect(()=>{if(!g)return;const r=setInterval(async()=>{try{const t=await m.getAllProgressStatuses();if(t.length>0){const o=t[0];te(o)}const i=await m.getOverallProgress();oe(i)}catch{}},1e3);return()=>clearInterval(r)},[g]);const le=async r=>{var t,i;if(r.preventDefault(),!y.trim()){c("Por favor, introduce un nombre para la instancia");return}if(!s){c("Por favor, selecciona una versión de Minecraft");return}if(n!=="vanilla"&&!v){c("Por favor, selecciona una versión del loader");return}x(!0),c(null);try{let o=v;if(n!=="vanilla"&&!o)switch(n){case"fabric":const h=V[s]||[];h.length>0&&(o=((t=h[0].loader)==null?void 0:t.version)||h[0].version);break;case"forge":const $=k[s]||[];$.length>0&&(o=$[0].version);break;case"quilt":const I=C[s]||[];I.length>0&&(o=((i=I[0].loader)==null?void 0:i.version)||I[0].version);break;case"neoforge":const H=S[s]||[];H.length>0&&(o=H[0].version);break}const u=await m.createInstance({name:y,version:s,loader:n,javaVersion:W||"17",maxMemory:N,minMemory:U,jvmArgs:L?L.split(" "):void 0}),J=T.getCurrentProfile();if(J)q.linkInstanceToProfile(u.id,J);else{const h=T.getAllProfiles();h.length>0&&q.linkInstanceToProfile(u.id,h[0].username)}F&&F(),p()}catch(o){console.error("Error al crear instancia:",o),c(`Error al crear la instancia: ${o.message||"Error desconocido"}`)}finally{x(!1)}},ce=()=>X.map(r=>({id:r.id,name:`${r.id}`})),de=()=>{switch(n){case"fabric":return V[s]||[];case"forge":return k[s]||[];case"quilt":return C[s]||[];case"neoforge":return S[s]||[];default:return[]}};if(!g)return null;const ue=de();return e.jsx(G,{children:e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gradient-to-br from-gray-900 via-gray-900 to-gray-800 z-50 flex items-center justify-center p-4",children:e.jsx(P.div,{initial:{scale:.95,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-2xl p-1 w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl shadow-blue-500/10",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 p-1 rounded-2xl",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-6 max-h-[calc(90vh-1rem)] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Crear Nueva Instancia"}),e.jsx("button",{onClick:p,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-full transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),A&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-red-900/50 to-red-800/30 border border-red-700/50 rounded-xl text-red-200 flex items-start",children:[e.jsx("svg",{className:"w-6 h-6 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:A})]}),b&&e.jsxs("div",{className:"mb-6 bg-gray-800/50 p-4 rounded-xl border border-gray-700/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Progreso general:"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:[Math.round(b.progress*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${b.progress*100}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400 flex justify-between",children:[e.jsx("span",{children:b.statusText}),e.jsxs("span",{children:[b.activeOperations," operaciones activas"]})]})]}),d&&d.status!=="completed"&&d.status!=="error"&&e.jsxs("div",{className:"mb-6 bg-blue-900/20 p-3 rounded-lg border border-blue-700/50",children:[e.jsxs("div",{className:"flex items-center text-blue-300 text-sm",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-blue-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"font-medium",children:d.target})]}),e.jsx("div",{className:"mt-1 text-xs text-blue-400",children:d.details||d.operation}),e.jsx("div",{className:"mt-2 w-full bg-blue-800/50 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300 ease-out",style:{width:`${d.progress*100}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-blue-300 text-right",children:[d.current," / ",d.total]})]}),e.jsxs("form",{onSubmit:le,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800/30 p-5 rounded-xl border border-gray-700/30",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})}),"Nombre de la instancia"]}),e.jsx("input",{type:"text",value:y,onChange:r=>Q(r.target.value),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Mi Mundo Creativo 1.20.1",disabled:l})]}),e.jsxs("div",{className:"bg-gray-800/30 p-6 rounded-xl border border-gray-700/30",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-4",children:[e.jsx("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Tipo de Loader"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-2",children:["vanilla","fabric","forge","quilt","neoforge"].map(r=>e.jsx("button",{type:"button",onClick:()=>{D(r),r==="vanilla"&&j("")},className:`py-2 px-1 rounded-lg border transition-all duration-300 transform hover:scale-105 min-h-[50px] flex flex-col justify-center items-center ${n===r?"bg-gradient-to-br from-blue-600 to-purple-600 border-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-600/50 disabled:opacity-50"}`,disabled:l,children:e.jsx("div",{className:"text-[0.65rem] sm:text-xs font-medium text-center leading-tight",children:r==="neoforge"?`Neo
Forge`:r.charAt(0).toUpperCase()+r.slice(1)})},r))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800/30 p-5 rounded-xl border border-gray-700/30",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),"Versión de Minecraft"]}),e.jsxs("select",{value:s,onChange:r=>O(r.target.value),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",disabled:l,children:[e.jsx("option",{value:"",children:"Selecciona una versión"}),ce().map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),n!=="vanilla"&&s&&e.jsxs("div",{className:"bg-gray-800/30 p-5 rounded-xl border border-gray-700/30",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:[e.jsxs("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Versión del Loader"]}),e.jsxs("select",{value:v,onChange:r=>j(r.target.value),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",disabled:l,children:[e.jsx("option",{value:"",children:"Selecciona una versión"}),ue.map((r,t)=>{var o;let i="";return n==="fabric"||n==="quilt"?i=((o=r.loader)==null?void 0:o.version)||r.version:(n==="forge"||n==="neoforge")&&(i=r.version),e.jsx("option",{value:i,children:i},t)})]})]}),e.jsxs("div",{className:"bg-gray-800/30 p-5 rounded-xl border border-gray-700/30",children:[e.jsxs("button",{type:"button",onClick:()=>R(!w),className:"w-full py-3 bg-gray-700/50 hover:bg-gray-600/50 border border-gray-600/50 rounded-xl text-white flex items-center justify-between transition-all duration-300",disabled:l,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"})}),e.jsx("span",{className:"font-medium",children:"Opciones Avanzadas"})]}),e.jsx("svg",{className:`w-5 h-5 transition-transform duration-300 ${w?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),e.jsx(G,{children:w&&e.jsxs(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-4 space-y-4 p-4 bg-gray-700/30 rounded-xl border border-gray-600/30",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Memoria RAM a usar (MB)"}),e.jsxs("span",{className:"text-sm font-medium bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-1 rounded-full min-w-[70px] text-center",children:[N," MB"]})]}),e.jsx("input",{type:"range",min:"1024",max:Math.min(z,16384),value:N,onChange:r=>{const t=parseInt(r.target.value);E(t),B(Math.max(1024,Math.floor(t/4)))},className:"w-full h-2 bg-gradient-to-r from-gray-600 to-gray-700 rounded-lg appearance-none cursor-pointer slider",disabled:l}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"1GB"}),e.jsxs("span",{children:[Math.min(z,16384),"MB"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Versión de Java"}),e.jsxs("select",{value:W,onChange:r=>f(r.target.value),className:"w-full px-3 py-2 bg-gray-600/50 border border-gray-500/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",disabled:l,children:[e.jsx("option",{value:"8",children:"Java 8"}),e.jsx("option",{value:"11",children:"Java 11"}),e.jsx("option",{value:"17",children:"Java 17"}),e.jsx("option",{value:"21",children:"Java 21"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Parámetros de Java"}),e.jsx("input",{type:"text",value:L,onChange:r=>re(r.target.value),className:"w-full px-3 py-2 bg-gray-600/50 border border-gray-500/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"-XX:+UseG1GC -Dfml.earlyprogresswindow=false",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Ruta de Java (opcional)"}),e.jsx("input",{type:"text",value:se,onChange:r=>ae(r.target.value),className:"w-full px-3 py-2 bg-gray-600/50 border border-gray-500/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"C:/Program Files/Java/jdk/bin/java.exe",disabled:l})]})]})})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-700/50",children:[e.jsx("button",{type:"button",onClick:p,disabled:l,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-xl transition-all duration-300 disabled:opacity-50 font-medium",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:l,className:"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white rounded-xl transition-all duration-300 disabled:opacity-50 font-medium flex items-center shadow-lg shadow-blue-500/20",children:[l&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),l?"Creando y descargando...":"Crear Instancia"]})]})]})]})})})})})};export{fe as C};
