import{r as t,j as e,p as T}from"./index-HKM3vO3i.js";import{i as g}from"./integratedDownloadService-Cr7ckuFJ.js";import{instanceProfileService as q}from"./instanceProfileService-BOxm3ZES.js";import{A as R,m as F}from"./proxy-B2QaA4U4.js";const fe=({isOpen:x,onClose:w,onCreated:A})=>{const[N,D]=t.useState(""),[n,G]=t.useState("vanilla"),[s,O]=t.useState(""),[f,j]=t.useState(""),[M,Q]=t.useState(!1),[U,B]=t.useState(2048),[k,z]=t.useState(4096),[$,V]=t.useState(8192),[X,K]=t.useState([]),[C,Y]=t.useState({}),[S,Z]=t.useState({}),[L,_]=t.useState({}),[I,ee]=t.useState({}),[l,h]=t.useState(!1),[W,u]=t.useState(null),[P,re]=t.useState(""),[se,ae]=t.useState(""),[J,b]=t.useState("17"),[m,te]=t.useState(null),[v,oe]=t.useState(null);t.useEffect(()=>{(async()=>{var a,i;try{if((i=(a=window.api)==null?void 0:a.system)!=null&&i.getTotalMemory){const o=await window.api.system.getTotalMemory(),c=Math.floor(o/(1024*1024));V(c),B(Math.min(2048,Math.floor(c/4))),z(Math.min(8192,Math.floor(c/2)))}else{const o=Math.min(16384,Math.max(4096,navigator.deviceMemory?navigator.deviceMemory*1024:8192));V(o)}}catch(o){console.warn("No se pudo obtener la memoria total del sistema:",o);const c=navigator.deviceMemory?navigator.deviceMemory*1024:8192;V(c)}})()},[]),t.useEffect(()=>{x&&ne()},[x]);const ne=async()=>{if(x){h(!0),u(null);try{const a=(await g.getMinecraftVersions()).filter(i=>i.type==="release");K(a)}catch(r){console.error("Error al cargar versiones:",r),u("Error al cargar las versiones disponibles. Por favor, inténtalo de nuevo más tarde.")}finally{h(!1)}}};t.useEffect(()=>{if(s){const r=parseInt(s.split(".")[1]||"0",10);r>=21?b("21"):r>=17?b("17"):r>=16?b("16"):b("8")}},[s]),t.useEffect(()=>{s&&n!=="vanilla"&&ie()},[n,s]);const ie=async()=>{if(s){console.log(`[CreateInstanceModal] Cargando versiones de ${n} para MC ${s}`),h(!0),u(null);try{switch(n){case"fabric":if(!S[s]){console.log("[CreateInstanceModal] Obteniendo versiones de Fabric...");const r=await g.getFabricVersions(s);console.log("[CreateInstanceModal] Versiones de Fabric obtenidas:",r),Z(a=>({...a,[s]:r}))}break;case"forge":if(!C[s]){console.log("[CreateInstanceModal] Obteniendo versiones de Forge...");const r=await g.getForgeVersions(s);console.log("[CreateInstanceModal] Versiones de Forge obtenidas:",r),Y(a=>({...a,[s]:r})),r.length>0&&!f&&j(r[0].version)}break;case"quilt":if(!L[s]){console.log("[CreateInstanceModal] Obteniendo versiones de Quilt...");const r=await g.getQuiltVersions(s);console.log("[CreateInstanceModal] Versiones de Quilt obtenidas:",r),_(a=>({...a,[s]:r}))}break;case"neoforge":if(!I[s]){console.log("[CreateInstanceModal] Obteniendo versiones de NeoForge...");const r=await g.getNeoForgeVersions(s);console.log("[CreateInstanceModal] Versiones de NeoForge obtenidas:",r),ee(a=>({...a,[s]:r})),r.length>0&&!f&&j(r[0].version)}break}}catch(r){console.error(`[CreateInstanceModal] Error al cargar versiones de ${n}:`,r),u(`Error al cargar las versiones de ${n}: ${r.message||"Error desconocido"}`)}finally{h(!1)}}};t.useEffect(()=>{if(!x)return;const r=setInterval(async()=>{try{const a=await g.getAllProgressStatuses();if(a.length>0){const o=a[0];te(o)}const i=await g.getOverallProgress();oe(i)}catch{}},1e3);return()=>clearInterval(r)},[x]);const le=async r=>{var a,i;if(r.preventDefault(),!N.trim()){u("Por favor, introduce un nombre para la instancia");return}if(!s){u("Por favor, selecciona una versión de Minecraft");return}if(n!=="vanilla"&&!f){u("Por favor, selecciona una versión del loader");return}h(!0),u(null);try{let o=f;if(n!=="vanilla"&&!o)switch(n){case"fabric":const d=S[s]||[];d.length>0&&(o=((a=d[0].loader)==null?void 0:a.version)||d[0].version);break;case"forge":const y=C[s]||[];y.length>0&&(o=y[0].version);break;case"quilt":const E=L[s]||[];E.length>0&&(o=((i=E[0].loader)==null?void 0:i.version)||E[0].version);break;case"neoforge":const H=I[s]||[];H.length>0&&(o=H[0].version);break}console.log(`[CreateInstanceModal] Creando instancia con loaderVersion: ${o||"NO ESPECIFICADA"}`);const c=await g.createInstance({name:N,version:s,loader:n,loaderVersion:o,javaVersion:J||"17",maxMemory:k,minMemory:U,jvmArgs:P?P.split(" "):void 0}),p=T.getCurrentProfile();if(p)q.linkInstanceToProfile(c.id,p);else{const d=T.getAllProfiles();d.length>0&&q.linkInstanceToProfile(c.id,d[0].username)}A&&A(),w()}catch(o){console.error("Error al crear instancia:",o),u(`Error al crear la instancia: ${o.message||"Error desconocido"}`)}finally{h(!1)}},ce=()=>X.map(r=>({id:r.id,name:`${r.id}`})),de=()=>{switch(n){case"fabric":return S[s]||[];case"forge":return C[s]||[];case"quilt":return L[s]||[];case"neoforge":return I[s]||[];default:return[]}};if(!x)return null;const ue=de();return e.jsx(R,{children:e.jsx(F.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gradient-to-br from-gray-900 via-gray-900 to-gray-800 z-50 flex items-center justify-center p-4",children:e.jsx(F.div,{initial:{scale:.95,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:20,opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-2xl p-1 w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl shadow-blue-500/10",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 p-1 rounded-2xl",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-6 max-h-[calc(90vh-1rem)] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Crear Nueva Instancia"}),e.jsx("button",{onClick:w,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-full transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),W&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-red-900/50 to-red-800/30 border border-red-700/50 rounded-xl text-red-200 flex items-start",children:[e.jsx("svg",{className:"w-6 h-6 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:W})]}),v&&e.jsxs("div",{className:"mb-6 bg-gray-800/50 p-4 rounded-xl border border-gray-700/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Progreso general:"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:[Math.round(v.progress*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${v.progress*100}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400 flex justify-between",children:[e.jsx("span",{children:v.statusText}),e.jsxs("span",{children:[v.activeOperations," operaciones activas"]})]})]}),m&&m.status!=="completed"&&m.status!=="error"&&e.jsxs("div",{className:"mb-6 bg-blue-900/20 p-3 rounded-lg border border-blue-700/50",children:[e.jsxs("div",{className:"flex items-center text-blue-300 text-sm",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-blue-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"font-medium",children:m.target})]}),e.jsx("div",{className:"mt-1 text-xs text-blue-400",children:m.details||m.operation}),e.jsx("div",{className:"mt-2 w-full bg-blue-800/50 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300 ease-out",style:{width:`${m.progress*100}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-blue-300 text-right",children:[m.current," / ",m.total]})]}),e.jsxs("form",{onSubmit:le,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800/30 p-5 rounded-xl border border-gray-700/30",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})}),"Nombre de la instancia"]}),e.jsx("input",{type:"text",value:N,onChange:r=>D(r.target.value),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Mi Mundo Creativo 1.20.1",disabled:l})]}),e.jsxs("div",{className:"bg-gray-800/30 p-6 rounded-xl border border-gray-700/30",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-4",children:[e.jsx("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Tipo de Loader"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-2",children:["vanilla","fabric","forge","quilt","neoforge"].map(r=>e.jsx("button",{type:"button",onClick:()=>{G(r),r==="vanilla"&&j("")},className:`py-2 px-1 rounded-lg border transition-all duration-300 transform hover:scale-105 min-h-[50px] flex flex-col justify-center items-center ${n===r?"bg-gradient-to-br from-blue-600 to-purple-600 border-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-gray-700/50 border-gray-600/50 text-gray-300 hover:bg-gray-600/50 disabled:opacity-50"}`,disabled:l,children:e.jsx("div",{className:"text-[0.65rem] sm:text-xs font-medium text-center leading-tight",children:r==="neoforge"?`Neo
Forge`:r.charAt(0).toUpperCase()+r.slice(1)})},r))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800/30 p-5 rounded-xl border border-gray-700/30",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),"Versión de Minecraft"]}),e.jsxs("select",{value:s,onChange:r=>O(r.target.value),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",disabled:l,children:[e.jsx("option",{value:"",children:"Selecciona una versión"}),ce().map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),n!=="vanilla"&&s&&e.jsxs("div",{className:"bg-gray-800/30 p-5 rounded-xl border border-gray-700/30",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:[e.jsxs("svg",{className:"w-5 h-5 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Versión del Loader"]}),e.jsxs("select",{value:f,onChange:r=>j(r.target.value),className:"w-full px-4 py-3 bg-gray-700/50 border border-gray-600/50 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",disabled:l,children:[e.jsx("option",{value:"",children:"Selecciona una versión"}),ue.map((r,a)=>{var p;let i="",o="";if(n==="fabric"||n==="quilt")i=((p=r.loader)==null?void 0:p.version)||r.version,o=i;else if(n==="forge"||n==="neoforge"){const d=r.version||"",y=d.split("-");i=y.length>1?y[1]:d,o=d}const c=a===0;return e.jsx("option",{value:o||i,children:c?`⭐ ${i} (Recomendada)`:i},a)})]})]}),e.jsxs("div",{className:"bg-gray-800/30 p-5 rounded-xl border border-gray-700/30",children:[e.jsxs("button",{type:"button",onClick:()=>Q(!M),className:"w-full py-3 bg-gray-700/50 hover:bg-gray-600/50 border border-gray-600/50 rounded-xl text-white flex items-center justify-between transition-all duration-300",disabled:l,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"})}),e.jsx("span",{className:"font-medium",children:"Opciones Avanzadas"})]}),e.jsx("svg",{className:`w-5 h-5 transition-transform duration-300 ${M?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),e.jsx(R,{children:M&&e.jsxs(F.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-4 space-y-4 p-4 bg-gray-700/30 rounded-xl border border-gray-600/30",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Memoria RAM a usar (MB)"}),e.jsxs("span",{className:"text-sm font-medium bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-1 rounded-full min-w-[70px] text-center",children:[k," MB"]})]}),e.jsx("input",{type:"range",min:"1024",max:Math.min($,16384),value:k,onChange:r=>{const a=parseInt(r.target.value);z(a),B(Math.max(1024,Math.floor(a/4)))},className:"w-full h-2 bg-gradient-to-r from-gray-600 to-gray-700 rounded-lg appearance-none cursor-pointer slider",disabled:l}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"1GB"}),e.jsxs("span",{children:[Math.min($,16384),"MB"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Versión de Java"}),e.jsxs("select",{value:J,onChange:r=>b(r.target.value),className:"w-full px-3 py-2 bg-gray-600/50 border border-gray-500/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",disabled:l,children:[e.jsx("option",{value:"8",children:"Java 8"}),e.jsx("option",{value:"11",children:"Java 11"}),e.jsx("option",{value:"17",children:"Java 17"}),e.jsx("option",{value:"21",children:"Java 21"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Parámetros de Java"}),e.jsx("input",{type:"text",value:P,onChange:r=>re(r.target.value),className:"w-full px-3 py-2 bg-gray-600/50 border border-gray-500/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"-XX:+UseG1GC -Dfml.earlyprogresswindow=false",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Ruta de Java (opcional)"}),e.jsx("input",{type:"text",value:se,onChange:r=>ae(r.target.value),className:"w-full px-3 py-2 bg-gray-600/50 border border-gray-500/50 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"C:/Program Files/Java/jdk/bin/java.exe",disabled:l})]})]})})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-700/50",children:[e.jsx("button",{type:"button",onClick:w,disabled:l,className:"px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-xl transition-all duration-300 disabled:opacity-50 font-medium",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:l,className:"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white rounded-xl transition-all duration-300 disabled:opacity-50 font-medium flex items-center shadow-lg shadow-blue-500/20",children:[l&&e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),l?"Creando y descargando...":"Crear Instancia"]})]})]})]})})})})})};export{fe as C};
