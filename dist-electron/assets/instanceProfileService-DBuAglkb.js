import{p as l}from"./index-DVpKWacu.js";const u="instance_profile_links";function o(){const n=localStorage.getItem(u);return n?JSON.parse(n):[]}function a(n){localStorage.setItem(u,JSON.stringify(n))}const I={linkInstanceToProfile(n,i){const t=o(),e=t.findIndex(s=>s.instanceId===n);e!==-1?t[e].profileUsername=i:t.push({instanceId:n,profileUsername:i}),a(t);const r=l.getProfileByUsername(i);if(r){const s=r.instances||[];s.includes(n)||l.updateProfile(i,{instances:[...s,n]})}return!0},unlinkInstance(n){const i=o(),t=i.length,e=i.filter(r=>r.instanceId!==n);return e.length!==t?(a(e),l.getAllProfiles().forEach(s=>{if(s.instances&&s.instances.includes(n)){const c=s.instances.filter(f=>f!==n);l.updateProfile(s.username,{...s,instances:c})}}),!0):!1},unlinkInstanceFromProfile(n,i){const t=o(),e=t.length,r=t.filter(s=>!(s.instanceId===n&&s.profileUsername===i));if(r.length!==e){a(r);const s=l.getProfileByUsername(i);if(s&&s.instances&&s.instances.includes(n)){const c=s.instances.filter(f=>f!==n);l.updateProfile(i,{...s,instances:c})}return!0}return!1},isInstanceLinkedToProfile(n,i){return o().some(e=>e.instanceId===n&&e.profileUsername===i)},getProfileForInstance(n){const t=o().find(e=>e.instanceId===n);return t==null?void 0:t.profileUsername},getInstancesForProfile(n){return o().filter(t=>t.profileUsername===n).map(t=>t.instanceId)},updatePlayTime(n,i,t){const e=o(),r=e.findIndex(s=>s.instanceId===n&&s.profileUsername===i);r!==-1?(e[r].timePlayed=(e[r].timePlayed||0)+t,e[r].lastPlayed=Date.now()):e.push({instanceId:n,profileUsername:i,timePlayed:t,lastPlayed:Date.now()}),a(e)},getPlayTime(n,i){const e=o().find(r=>r.instanceId===n&&r.profileUsername===i);return(e==null?void 0:e.timePlayed)||0},getInstancesWithProfileInfo(){return o()}};export{I as instanceProfileService};
