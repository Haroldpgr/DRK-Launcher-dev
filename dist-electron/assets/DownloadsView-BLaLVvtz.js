import{r as l,j as e,n as M}from"./index-DO-f14RZ.js";import{C as V}from"./Card-D7QD4blf.js";import{B as H}from"./Button-CqJwvyh9.js";import{i as n}from"./integratedDownloadService-C5v-R2yv.js";import{m as c}from"./proxy-zTRYDWLN.js";const U=()=>{const[p,N]=l.useState([]),[h,y]=l.useState([]),[w,D]=l.useState([]),[x,T]=l.useState(""),[d,b]=l.useState("active"),[m,C]=l.useState(null),[g,L]=l.useState(null),[u,E]=l.useState([]),[S,k]=l.useState(null);l.useEffect(()=>{B(),f();const t=setInterval(async()=>{try{const a=(await n.getDownloadStatuses()).filter(i=>i.status==="in-progress"||i.status==="pending");N(a);const o=await n.getOverallProgress();C(o);const v=await n.getLogStats();L(v)}catch(s){console.error("Error updating progress:",s)}},1e3),r=setInterval(async()=>{try{const s=await n.getRecentLogs(50);D(s);const a=s.filter(o=>o.type==="download"||o.type==="install"||o.type==="success");y(a)}catch(s){console.error("Error updating logs:",s)}},2e3);return()=>{clearInterval(t),clearInterval(r)}},[]);const f=async()=>{try{const t=await n.getIncompleteDownloads();E(t),t.length>0&&console.log(`[DownloadsView] Encontradas ${t.length} descargas incompletas`)}catch(t){console.error("Error cargando descargas incompletas:",t)}},A=async t=>{try{k(t),await n.resumeDownload(t),await f(),M.showNotification({type:"success",title:"Descarga reanudada",message:"La descarga se ha reanudado correctamente.",duration:3e3})}catch(r){console.error("Error al reanudar descarga:",r),M.showNotification({type:"error",title:"Error al reanudar",message:`No se pudo reanudar la descarga: ${r.message}`,duration:4e3})}finally{k(null)}},B=async()=>{try{const r=(await n.getDownloadStatuses()).filter(i=>i.status==="in-progress"||i.status==="pending");N(r);const s=await n.getOverallProgress();C(s);const a=await n.getRecentLogs(50);D(a);const o=await n.getLogStats();L(o);const v=a.filter(i=>i.type==="download"||i.type==="install"||i.type==="success");y(v)}catch(t){console.error("Error loading initial data:",t)}},$=w.filter(t=>t.message.toLowerCase().includes(x.toLowerCase())||t.target&&t.target.toLowerCase().includes(x.toLowerCase())),R=h.filter(t=>t.message.toLowerCase().includes(x.toLowerCase())||t.target&&t.target.toLowerCase().includes(x.toLowerCase())),z=()=>{y([])},O=t=>{if(t===0)return"0 B/s";const r=1024,s=["B/s","KB/s","MB/s","GB/s"],a=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,a)).toFixed(2))+" "+s[a]},P=t=>{if(!t||t<=0)return"";const r=Math.floor(t/1e3);if(r<60)return`${r}s`;const s=Math.floor(r/60);return s<60?`${s}m`:`${Math.floor(s/60)}h ${s%60}m`},F=t=>{switch(t){case"completed":return"text-green-500";case"error":return"text-red-500";case"in-progress":return"text-blue-500";case"pending":return"text-yellow-500";case"cancelled":return"text-gray-500";default:return"text-gray-500"}},j=t=>{switch(t){case"success":return"text-green-500";case"error":return"text-red-500";case"warning":return"text-yellow-500";case"info":return"text-blue-500";case"progress":return"text-purple-500";case"download":return"text-cyan-500";case"install":return"text-emerald-500";case"launch":return"text-orange-500";default:return"text-gray-500"}},I=t=>{switch(t){case"success":return"âœ…";case"error":return"âŒ";case"warning":return"âš ï¸";case"info":return"â„¹ï¸";case"progress":return"ðŸ”„";case"download":return"ðŸ“¥";case"install":return"âš™ï¸";case"launch":return"ðŸš€";default:return"ðŸ“„"}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(V,{children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-200 flex items-center gap-2",children:["Progreso y Descargas",e.jsxs("span",{className:"text-xs font-semibold text-gray-400 bg-gray-800/80 px-2 py-0.5 rounded-full",children:[p.length," activas Â· ",h.length," completadas"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Seguimiento en tiempo real de todas las operaciones"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"text",placeholder:"Buscar en registros...",value:x,onChange:t=>T(t.target.value),className:"px-4 py-2 rounded-lg bg-gray-800/80 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"}),e.jsx(H,{variant:"secondary",onClick:z,disabled:h.length===0,children:"Limpiar historial"})]})]}),m&&e.jsxs("div",{className:"bg-gray-800/50 p-4 rounded-xl border border-gray-700/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Progreso general:"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-400",children:[Math.round(m.progress*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-300 ease-out",style:{width:`${m.progress*100}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400 flex justify-between",children:[e.jsx("span",{children:m.statusText}),e.jsxs("span",{children:[m.activeOperations," operaciones activas"]})]})]}),g&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gray-800/40 p-3 rounded-lg border border-gray-700/50 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-400",children:g.totalLogs}),e.jsx("div",{className:"text-xs text-gray-400",children:"Registros"})]}),e.jsxs("div",{className:"bg-gray-800/40 p-3 rounded-lg border border-gray-700/50 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-400",children:g.activeDownloads}),e.jsx("div",{className:"text-xs text-gray-400",children:"Descargas activas"})]}),e.jsxs("div",{className:"bg-gray-800/40 p-3 rounded-lg border border-gray-700/50 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-emerald-400",children:g.recentLogs}),e.jsx("div",{className:"text-xs text-gray-400",children:"Recientes"})]}),e.jsxs("div",{className:"bg-gray-800/40 p-3 rounded-lg border border-gray-700/50 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-amber-400",children:g.totalProgressUpdates}),e.jsx("div",{className:"text-xs text-gray-400",children:"Actualizaciones"})]})]}),e.jsxs("div",{className:"inline-flex items-center bg-gray-900/80 border border-gray-700/70 rounded-2xl p-1 text-xs text-gray-300 self-start",children:[e.jsx("button",{onClick:()=>b("active"),className:`px-3 py-1 rounded-xl transition-all ${d==="active"?"bg-gradient-to-r from-blue-500 to-indigo-600 text-black shadow-sm":"text-gray-400 hover:text-gray-200"}`,children:"Activas"}),e.jsx("button",{onClick:()=>b("completed"),className:`ml-1 px-3 py-1 rounded-xl transition-all ${d==="completed"?"bg-gradient-to-r from-emerald-500 to-teal-600 text-black shadow-sm":"text-gray-400 hover:text-gray-200"}`,children:"Completadas"}),e.jsx("button",{onClick:()=>b("logs"),className:`ml-1 px-3 py-1 rounded-xl transition-all ${d==="logs"?"bg-gradient-to-r from-purple-500 to-pink-600 text-black shadow-sm":"text-gray-400 hover:text-gray-200"}`,children:"Registros"})]})]}),d==="active"&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-200 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“¥"})," Descargas Activas",e.jsx("span",{className:"ml-2 text-sm text-gray-400 bg-gray-700/50 py-0.5 px-2 rounded-full",children:p.length+u.length})]}),u.length>0&&e.jsx("button",{onClick:f,className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",children:"Actualizar"})]}),u.length>0&&e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-yellow-400 flex items-center gap-2",children:[e.jsx("span",{children:"âš ï¸"})," Descargas Incompletas (",u.length,")"]}),u.map(t=>e.jsxs(c.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"p-5 bg-gradient-to-br from-yellow-900/20 to-orange-900/20 backdrop-blur-sm rounded-xl border border-yellow-700/50 hover:border-yellow-500/50 transition-all duration-300 shadow-lg",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-100 truncate",children:t.instanceName}),e.jsxs("span",{className:"text-xs px-2.5 py-1 rounded-full font-medium text-yellow-400 bg-yellow-500/20 border border-yellow-500/30",children:[t.loader," ",t.mcVersion]})]}),e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:t.currentStep}),t.error&&e.jsxs("div",{className:"text-xs text-red-400 mt-1",children:["Error: ",t.error]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"w-full bg-gray-700/50 rounded-full h-3.5 overflow-hidden",children:e.jsx(c.div,{initial:{width:0},animate:{width:`${t.progress*100}%`},className:"bg-gradient-to-r from-yellow-500 to-orange-500 h-3.5 rounded-full"})}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 mt-2",children:[e.jsxs("span",{children:[Math.round(t.progress*100),"%"]}),e.jsxs("span",{children:[t.completedSteps," / ",t.totalSteps," pasos"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-700/50",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Iniciada: ",new Date(t.startedAt).toLocaleString()]}),e.jsx(c.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>A(t.id),disabled:S===t.id,className:"px-4 py-2 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 rounded-lg transition-all text-sm font-medium border border-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:S===t.id?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Reanudando..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Reanudar Descarga"]})})]})]},t.id))]}),p.length===0?e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12 text-gray-500 bg-gradient-to-br from-gray-800/30 to-gray-900/30 rounded-xl border border-dashed border-gray-700/50",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“­"}),e.jsx("p",{className:"text-gray-400",children:"No hay descargas activas en este momento"})]}):e.jsx("div",{className:"space-y-4",children:p.map((t,r)=>e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.1},className:"p-5 bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm rounded-xl border border-gray-700/50 hover:border-blue-500/50 transition-all duration-300 shadow-lg hover:shadow-blue-500/10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-100 truncate",children:t.target||t.operation}),e.jsx(c.span,{animate:{scale:[1,1.1,1]},transition:{repeat:1/0,duration:2},className:`text-xs px-2.5 py-1 rounded-full font-medium ${F(t.status)} bg-opacity-20 border border-current border-opacity-30`,children:t.status==="in-progress"?"Descargando...":t.status})]}),t.details&&e.jsx("div",{className:"text-sm text-gray-400 mt-1 truncate",children:t.details})]}),e.jsx("div",{className:"text-right text-sm text-blue-400 whitespace-nowrap ml-4 font-medium",children:t.speed&&O(t.speed)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"w-full bg-gray-700/50 rounded-full h-3.5 overflow-hidden",children:e.jsx(c.div,{initial:{width:0},animate:{width:`${t.progress*100}%`},transition:{duration:.5,ease:"easeOut"},className:`h-3.5 rounded-full relative ${t.status==="completed"?"bg-gradient-to-r from-green-500 to-emerald-500":t.status==="error"?"bg-gradient-to-r from-red-500 to-rose-500":t.status==="pending"?"bg-gradient-to-r from-yellow-500 to-amber-500":"bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-600"}`,children:e.jsx(c.div,{animate:{x:["-100%","100%"]},transition:{repeat:1/0,duration:1.5,ease:"linear"},className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent"})})}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 mt-2",children:[e.jsxs("span",{children:[Math.round(t.progress*100),"%"]}),t.estimatedTimeRemaining&&e.jsxs("span",{className:"text-blue-400",children:["Quedan: ",P(t.estimatedTimeRemaining)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500 pt-2 border-t border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-400",children:[t.current," / ",t.total]}),e.jsx("span",{className:"text-gray-600",children:"â€¢"}),e.jsx("span",{className:"text-gray-400",children:t.operation})]}),t.status==="error"&&e.jsx(c.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{console.log("Reanudar descarga:",t.id)},className:"px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 rounded-lg transition-all text-xs font-medium border border-blue-500/30",children:"Reintentar"})]})]},t.id))})]}),d==="completed"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-200 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"âœ…"})," Tareas Completadas",e.jsx("span",{className:"ml-2 text-sm text-gray-400 bg-gray-700/50 py-0.5 px-2 rounded-full",children:h.length})]}),R.length===0?e.jsx("div",{className:"text-center py-10 text-gray-500 border border-dashed border-gray-700/70 rounded-2xl bg-gray-900/40",children:"No hay tareas completadas todavÃ­a."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.map(t=>e.jsxs("div",{className:"p-4 bg-gray-800/60 backdrop-blur-sm rounded-2xl border border-gray-700/70 shadow-sm flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:I(t.type)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-100 truncate",title:t.message,children:t.message}),t.target&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Objetivo: ",t.target]})]})]})}),e.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full ${j(t.type)}/20 ${j(t.type)} text-xs`,children:"âœ“"})]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500",children:e.jsx("span",{children:new Date(t.timestamp).toLocaleString()})})]},t.id))})]}),d==="logs"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-200 mb-4 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“‹"})," Registros de Actividad",e.jsx("span",{className:"ml-2 text-sm text-gray-400 bg-gray-700/50 py-0.5 px-2 rounded-full",children:w.length})]}),$.length===0?e.jsx("div",{className:"text-center py-10 text-gray-500 border border-dashed border-gray-700/70 rounded-2xl bg-gray-900/40",children:"No hay registros de actividad todavÃ­a."}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:$.map(t=>e.jsx("div",{className:`p-3 rounded-lg border-l-4 ${t.type==="error"?"border-red-500 bg-red-900/20":t.type==="success"?"border-green-500 bg-green-900/20":t.type==="warning"?"border-yellow-500 bg-yellow-900/20":t.type==="info"?"border-blue-500 bg-blue-900/20":t.type==="progress"?"border-purple-500 bg-purple-900/20":t.type==="download"?"border-cyan-500 bg-cyan-900/20":t.type==="install"?"border-emerald-500 bg-emerald-900/20":t.type==="launch"?"border-orange-500 bg-orange-900/20":"border-gray-500 bg-gray-900/20"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"mr-3 text-lg",children:I(t.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`font-medium ${j(t.type)}`,children:t.message}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(t.timestamp).toLocaleTimeString()})]}),t.target&&e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:t.target}),t.details&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 bg-black/20 p-2 rounded",children:e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:JSON.stringify(t.details,null,2)})})]})]})},t.id))})]})]})})};export{U as default};
